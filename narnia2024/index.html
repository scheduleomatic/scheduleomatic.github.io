<!DOCTYPE html>
<meta charset=utf-8>
<script src=https://code.jquery.com/jquery-3.7.1.slim.min.js></script>
<link rel=stylesheet href=../style.css>
<title>Narnia 2024 Schedule-o-Matic</title>

<h1>Schedule-o-Matic</h1>

<div id=input>
  <table>
    <tr class=name>
      <th>Dancer Name:
      <td><input>
    <tr class=ballet>
      <th>Ballet:
      <td>
        <select>
          <option value="">none
          <option value=-2>Sat 09:45, Stepping Stones
          <option value=-1>Sat 10:30, Pre-Primary
          <option value=0 >Sat 11:30, Primary
          <option value=1 >Sat 12:30, Grade 1
          <option value=2 >Mon 16:00, Grade 2
          <option value=3 >Mon 17:00, Grade 3
          <option value=6 >Tue 18:30, Class Level 6/Grade 5
          <option value=4 >Wed 18:00, Class Level 4
          <option value=7 >Fri 16:30, Grade 6
          <option value=5 >Fri 18:30, Class Level 5
        </select>
    <tr class=associates>
      <th>Associates:
      <td>
        <select>
          <option value="">none
          <option value=1 >Mon 18:00, Junior
          <option value=2 >Mon 19:30, Senior
        </select>
    <tr class=modern>
      <th>Modern/Tap:
      <td>
        <select>
          <option value="">none
          <option value=-1>Tue 15:45, Pre-Primary
          <option value=0 >Tue 16:30, Primary
          <option value=3 >Tue 17:30, Grade 3
          <option value=1 >Wed 16:00, Grade 1
          <option value=2 >Wed 17:00, Grade 2
          <option value=10>Wed 19:00, Adult Beginners
          <option value=4 >Thu 16:00, Grade 4
          <option value=5 >Thu 18:00, Grade 5
          <option value=6 >Thu 19:00, Grade 6
          <option value=11>Fri 19:30, Adult Improvers
        </select>
    <tr class=jazz>
      <th>Jazz:
      <td>
        <select>
          <option value="">none
          <option value=1 >Bronze
          <option value=2 >Silver
          <option value=3 >Gold
        </select>
    <tr class=choreography>
      <th>Choreography:
      <td>
        <select>
          <option value="">none
          <option value=1 >Fri 17:30
        </select>
    <tr class=principal>
      <th>Principal Part:
      <td>
        <select>
          <option value="">none
          <option value=fc>Father Christmas
        </select>
  </table>
  <p><button id=go>Create Schedule</button>
</div>

<div id=output>
</div>

<script>
const MAX_DANCERS = 4;
$(function()
{
  var row = 0;
  // Clone the dancer 0 interface for dancers 1 to 3:
  $('#input td').each((i, cell) =>
  {
    $(cell).children(':input').attr('tabindex', ++row);
    for (let col = MAX_DANCERS; col > 1; col--)
    {
      var clone = $(cell).clone();
      clone.children(':input')
        .val('')
        .attr('tabindex', row + col * 10);
      $(cell).after(clone);
    }
  });

  // Focus the first widget:
  $('#input :input').first().focus();

  // Show the shedule:
  $('#go').click(function()
  {
    // List of fields per dancer, taken from the row classes:
    var field = $('#input tr').map((i, row) => $(row).attr('class')).get();

    var dancer = $.map
    (
      $.grep
      (
        $.map
        (
          [...Array(MAX_DANCERS).keys()],
          (col) =>
              [
                $.grep
                (
                  $.map(field, (label) =>
                  ({
                    label: label,
                    val:   $('#input tr.' + label + ' :input').eq(col).val(),
                  })
                ),
                (item) => item.val != '')
              ]
        ),
        (record) => record.length > 0
      ),
      (record) => Object.fromEntries
          ($.map(record, (pair) => [[pair.label, pair.val]]))
    );

    var row = [];

    var text = $.map(dancer,
        (dancer) =>
        {
          if (dancer.ballet >= 2)
              return "Big ballet";
          if (dancer.ballet < 2)
              return "Little ballet";
          return "";
        });
    if (!text.every((content) => content == ""))
      row.push("Saturday March 9th: Act 2 Rehearsal", text);

    var output = '';

    // Only show the table if there are any rows:
    if (row.length >= 1)
    {
      output = '<table>';

      // Have a header row of names if there's more than 1 dancer, or if any
      // names have been specified:
      var needed = dancer.length > 1;
      var name = $.map(dancer,
          (dancer, col) =>
          {
            // If no name specified, use “Dancer 1”, etc when multiple dancers:
            if (dancer.name === undefined)
              return 'Dancer ' + (col + 1);
            else
            {
              needed = true;
              return dancer.name;
            }
          });
      if (needed)
        output += '<tr>' + $.map(name, (text) => '<th>' + text).join('');

      // Add the rest of the table:
      output += $.map
          (
            row,
            (cell) =>
                Array.isArray(cell) ?

                // A row of cells:
                '<tr>' + $.map(cell, (text) => '<td>' + text).join('')

                // A heading row, spanning the cells:
                : '<tr><td colspan=' + dancer.length + '>' + cell
          ).join("\n")
          + '</table>';
    }

    $('#output').html(output);
  });
});
</script>

<!--

All the types of dancing

Parts (grouped)

Reading from URL hash

Writing to URL hash

Save/bookmark link

Print CSS to hide form

General CSS for niceness

Costume collection

Include what to bring to each (at least normal kit, box, evacuee stuff, etc;
and bring back hair fasteners)

Plug St John's, either way

-->
